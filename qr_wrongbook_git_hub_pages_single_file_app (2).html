<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Wrongbook</title>
  <meta name="description" content="A lightweight, single-file wrong-question notebook for Quant Research prep. Save text or screenshots, tag by category, difficulty, and mastery. Works offline via IndexedDB.">
  <style>
    :root{
      --bg:#0b0f14; --card:#121821; --muted:#10151d; --muted-2:#0d131a;
      --text:#d6deeb; --text-dim:#9fb0c8; --brand:#4fd1c5; --accent:#7aa2f7; --danger:#ef6d6d; --ok:#5bd37d; --warn:#f5d06f;
      --border: #1f2a37; --shadow: rgba(0,0,0,.4);
    }
    /* ‰∏ªÈ¢òÂÆö‰πâ */
    .theme-light {
      --bg:#fdfdfd; --card:#ffffff; --muted:#f3f3f3; --muted-2:#e9e9e9;
      --text:#1a1a1a; --text-dim:#444; --brand:#0077cc; --accent:#3366cc;
      --danger:#cc3333; --ok:#228833; --warn:#cc8800;
      --border:#ccc; --shadow:rgba(0,0,0,.1);
    }
    .theme-green {
      --bg:#0e1b12; --card:#14271b; --muted:#1a3222; --muted-2:#112018;
      --text:#d8f5e0; --text-dim:#a8cbb3; --brand:#4fd18b; --accent:#6fe6b5;
      --danger:#ef6d6d; --ok:#6ae69b; --warn:#d6f56f;
      --border:#244030; --shadow:rgba(0,0,0,.4);
    }
    .theme-wood {
      --bg:#f5f1eb; --card:#faf7f2; --muted:#e9e3db; --muted-2:#e0d7ce;
      --text:#2e261c; --text-dim:#5a4d3e; --brand:#c78d4d; --accent:#b37532;
      --danger:#a94442; --ok:#3c763d; --warn:#8a6d3b;
      --border:#d2c4b5; --shadow:rgba(0,0,0,.15);
    }
    .theme-dark {
      /* ÈªòËÆ§ dark Ê†∑ÂºèÁî® :root */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#0a0e13);color:var(--text);font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji"}
    a{color:var(--accent);text-decoration:none}
    header{position:sticky;top:0;z-index:5;background:rgba(11,15,20,.8);backdrop-filter:saturate(140%) blur(10px);border-bottom:1px solid var(--border)}
    .stack{display:flex;gap:.75rem;align-items:center}
    .bar{max-width:1120px;margin:0 auto;padding:.75rem 1rem;display:flex;gap:.75rem;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:.5rem;align-items:center;font-weight:700;letter-spacing:.2px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--brand);box-shadow:0 0 18px var(--brand)}
    .title{font-size:1.05rem}
    .btn{border:1px solid var(--border);background:linear-gradient(180deg,var(--card),var(--muted));color:var(--text);padding:.55rem .9rem;border-radius:.75rem;cursor:pointer;transition:transform .04s ease, background .2s ease;box-shadow:0 2px 0 var(--shadow)}
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(180deg,#0f1723, #152235);border-color:#213047}
    .btn.ghost{background:transparent}
    .btn.danger{border-color:#3a2226;color:#ffd9d9;background:linear-gradient(180deg,#251015,#33151b)}
    .container{max-width:1120px;margin:0 auto;padding:1rem}
    .controls{display:grid;grid-template-columns:1fr;gap:.75rem;margin:1rem 0}
    @media(min-width:840px){.controls{grid-template-columns: 1fr 1fr 1fr auto}}
    .field{background:var(--card);border:1px solid var(--border);border-radius:.75rem;padding:.5rem .75rem;display:flex;gap:.5rem;align-items:center}
    input[type="text"], select{width:100%;background:transparent;border:none;outline:none;color:var(--text)}
    .chips{display:flex;flex-wrap:wrap;gap:.4rem}
    .chip{padding:.25rem .5rem;border-radius:999px;border:1px solid var(--border);font-size:.8rem;background:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr;gap:.9rem}
    @media(min-width:720px){.grid{grid-template-columns: repeat(2,1fr)}}
    @media(min-width:1040px){.grid{grid-template-columns: repeat(3,1fr)}}
    .card{background:linear-gradient(180deg,var(--card),var(--muted-2));border:1px solid var(--border);border-radius:1rem;overflow:hidden;box-shadow:0 6px 20px var(--shadow)}
    .card .top{padding:.9rem .95rem;border-bottom:1px solid var(--border);display:flex;gap:.6rem;align-items:center;justify-content:space-between}
    .card .top .badges{display:flex;gap:.35rem;flex-wrap:wrap}
    .badge{font-size:.72rem;padding:.25rem .5rem;border-radius:.5rem;border:1px solid var(--border);background:var(--muted)}
    .badge.diff-Easy{background:#11331f;border-color:#184528;color:#a5f3bf}
    .badge.diff-Medium{background:#2b2b14;border-color:#3a3a1a;color:#f5e6a6}
    .badge.diff-Hard{background:#2a1a1a;border-color:#3a2323;color:#f0b3b3}
    .badge.diff-Deadly{background:#3a1111;border-color:#4a1616;color:#ffb0b0}
    .badge.cat-Code{background:#152737;color:#9ecbff}
    .badge.cat-Math{background:#1e2632;color:#c6d7ff}
    .badge.cat-Behavior.question{background:#1f2430;color:#e6d0ff}
    .badge.cat-Machine.Learning{background:#121f23;color:#b6f3e0}
    .badge.mastery-Mastered{background:#102415;color:#baf7c9}
    .content{padding:.9rem .95rem}
    .content p{margin:.3rem 0 .6rem;color:var(--text-dim)}
    .thumbs{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.5rem}
    .thumbs img{height:68px;width:100px;object-fit:cover;border-radius:.4rem;border:1px solid var(--border)}
    .actions{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.6rem}
    .tag{opacity:.8;font-size:.8rem}

    /* dialog */
    dialog{border:none;border-radius:1rem;max-width:820px;width:95vw;background:linear-gradient(180deg,#101826,#0e1622);color:var(--text);padding:0}
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .dlg-head{padding:1rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
    .dlg-body{padding:1rem;display:grid;gap:.75rem}
    .dlg-grid{display:grid;gap:.6rem}
    @media(min-width:820px){.dlg-grid{grid-template-columns:1fr 1fr}}
    textarea{width:100%;min-height:120px;background:var(--muted);color:var(--text);border:1px solid var(--border);border-radius:.75rem;padding:.6rem;resize:vertical}
    .dropzone{border:1px dashed #2b3a50;border-radius:.75rem;padding:1rem;text-align:center;background:#0c131c}
    .dropzone.drag{outline:2px dashed var(--accent);outline-offset:4px}
    .previews{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.5rem}
    .previews img{height:80px;width:118px;object-fit:cover;border-radius:.4rem;border:1px solid var(--border)}
    .dlg-foot{padding:1rem;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
    .small{font-size:.85rem;color:var(--text-dim)}
    .hide{display:none}
    footer{opacity:.7;margin:2rem 0;text-align:center;font-size:.85rem}
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="brand"><span class="dot"></span><span class="title">QR Wrongbook</span></div>
      <div class="stack">
        <button class="btn" id="btnAdd">Add Problem</button>
        <button class="btn" id="btnExport" title="Download a backup JSON">Export</button>
        <button class="btn" id="btnImport">Import</button>
        <button class="btn" id="btnTheme">Theme</button>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="controls">
      <div class="field" title="Search by title/question/notes">
        üîé <input id="q" type="text" placeholder="Search‚Ä¶ (title, question, notes)">
      </div>
      <div class="field">
        üß≠
        <select id="fCategory" multiple title="Filter by category (Cmd/Ctrl-click for multi)">
          <option>Code</option>
          <option>Math</option>
          <option>Behavior question</option>
          <option>Machine Learning</option>
        </select>
      </div>
      <div class="field">
        üéØ
        <select id="fDifficulty" multiple title="Filter by difficulty (Cmd/Ctrl-click for multi)">
          <option>Easy</option>
          <option>Medium</option>
          <option>Hard</option>
          <option>Deadly</option>
        </select>
      </div>
      <div class="field">
        üìà
        <select id="fMastery" multiple title="Filter by mastery (Cmd/Ctrl-click for multi)">
          <option>Not at all</option>
          <option>A bit</option>
          <option>Slightly unsure</option>
          <option>Calculation error</option>
          <option>Mastered</option>
        </select>
      </div>
    </div>

    <div class="stack" style="justify-content:space-between;margin:.25rem 0 1rem">
      <div class="chips" id="stats"></div>
      <div class="chips">
        <span class="chip">Sort:
          <select id="sort">
            <option value="new">Newest</option>
            <option value="old">Oldest</option>
            <option value="diff">Difficulty</option>
            <option value="mastery">Mastery</option>
            <option value="cat">Category</option>
          </select>
        </span>
        <button class="btn ghost" id="btnClearFilters" title="Reset filters">Reset filters</button>
      </div>
    </div>

    <div class="grid" id="list"></div>
  </div>

  <dialog id="dlg">
    <form method="dialog" id="problemForm">
      <div class="dlg-head">
        <strong id="dlgTitle">Add Problem</strong>
        <button class="btn ghost" id="btnClose" value="close">‚úï</button>
      </div>
      <div class="dlg-body">
        <div class="dlg-grid">
          <div class="field">
            <input type="text" id="title" placeholder="Title (short & searchable)" required>
          </div>
          <div class="field">
            <input type="text" id="source" placeholder="Source (e.g. Citadel pad / book / link)">
          </div>
        </div>
        <label>Question</label>
        <textarea id="question" placeholder="Paste the problem statement. You can also paste an image from clipboard (Cmd/Ctrl+V) while this dialog is open."></textarea>
        <label>Notes / Solution idea</label>
        <textarea id="notes" placeholder="Your notes, approaches, pitfalls, references‚Ä¶"></textarea>

        <div class="dlg-grid">
          <div class="field">
            <select id="category" required>
              <option value="">Category‚Ä¶</option>
              <option>Code</option>
              <option>Math</option>
              <option>Behavior question</option>
              <option>Machine Learning</option>
            </select>
          </div>
          <div class="field">
            <select id="difficulty" required>
              <option value="">Difficulty‚Ä¶</option>
              <option>Easy</option>
              <option>Medium</option>
              <option>Hard</option>
              <option>Deadly</option>
            </select>
          </div>
        </div>

        <div class="dlg-grid">
          <div class="field">
            <select id="mastery" required>
              <option value="">Mastery‚Ä¶</option>
              <option>Not at all</option>
              <option>A bit</option>
              <option>Slightly unsure</option>
              <option>Calculation error</option>
              <option>Mastered</option>
            </select>
          </div>
          <div class="field">
            <input type="text" id="tags" placeholder="Optional tags (comma separated)">
          </div>
        </div>

        <div>
          <div class="dropzone" id="dropzone"><strong>Drop screenshots here</strong> or click to upload.<br><span class="small">PNG/JPG supported. You can also paste (Cmd/Ctrl+V) directly.</span></div>
          <input class="hide" type="file" id="images" accept="image/*" multiple>
          <div class="previews" id="previews"></div>
        </div>
      </div>
      <div class="dlg-foot">
        <span class="small">All data is saved locally in your browser (IndexedDB). Use <em>Export</em> to back up or move machines.</span>
        <div class="stack">
          <button class="btn" id="btnSave" value="default">Save</button>
        </div>
      </div>
    </form>
  </dialog>

  <input id="importInput" class="hide" type="file" accept="application/json"/>

  <footer>Built for relentless QR prep. v1.0 ‚Äî Single-file, no backend. üîí Local-only until you export.</footer>

  <script>
  (function(){
    const DIFF = ["Easy","Medium","Hard","Deadly"];
    const CATS = ["Code","Math","Behavior question","Machine Learning"];
    const MAST = ["Not at all","A bit","Slightly unsure","Calculation error","Mastered"];

    // ---------- Theme handling ----------
    const THEMES = ["dark","light","green","wood"];
    let currentTheme = localStorage.getItem("theme") || "dark";
    applyTheme(currentTheme);
    document.querySelector('#btnTheme').addEventListener('click', ()=>{
      let idx = THEMES.indexOf(currentTheme);
      currentTheme = THEMES[(idx+1)%THEMES.length];
      applyTheme(currentTheme);
      localStorage.setItem("theme", currentTheme);
    });
    function applyTheme(name){
      document.documentElement.classList.remove(...THEMES.map(t=>"theme-"+t));
      document.documentElement.classList.add("theme-"+name);
    }

    // ---------- IndexedDB minimal wrapper ----------
    const DB_NAME = 'qr-wrongbook';
    const STORE = 'problems';
    let dbPromise = null;
    function openDB(){
      if(dbPromise) return dbPromise;
      dbPromise = new Promise((resolve, reject)=>{
        const req = indexedDB.open(DB_NAME, 1);
        req.onupgradeneeded = (e)=>{
          const db = req.result;
          if(!db.objectStoreNames.contains(STORE)){
            const os = db.createObjectStore(STORE, { keyPath: 'id' });
            os.createIndex('createdAt','createdAt');
            os.createIndex('category','category');
            os.createIndex('difficulty','difficulty');
            os.createIndex('mastery','mastery');
          }
        };
        req.onsuccess = ()=>resolve(req.result);
        req.onerror = ()=>reject(req.error);
      });
      return dbPromise;
    }
    function tx(mode='readonly'){
      return openDB().then(db=>db.transaction(STORE, mode).objectStore(STORE));
   
